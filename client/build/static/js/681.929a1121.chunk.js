/*! For license information please see 681.929a1121.chunk.js.LICENSE.txt */
(self.webpackChunkproduct_traceability_client=self.webpackChunkproduct_traceability_client||[]).push([[681],{1942:(e,t,r)=>{e.exports=r(3488)()},2296:(e,t,r)=>{"use strict";r.r(t),r.d(t,{InView:()=>p,default:()=>p,defaultFallbackInView:()=>d,observe:()=>m,useInView:()=>g});var n=r(9950);function l(){return l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},l.apply(this,arguments)}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}var a=new Map,s=new WeakMap,i=0,c=void 0;function d(e){c=e}function u(e){return Object.keys(e).sort().filter(function(t){return void 0!==e[t]}).map(function(t){return t+"_"+("root"===t?(r=e.root)?(s.has(r)||(i+=1,s.set(r,i.toString())),s.get(r)):"0":e[t]);var r}).toString()}function m(e,t,r,n){if(void 0===r&&(r={}),void 0===n&&(n=c),"undefined"===typeof window.IntersectionObserver&&void 0!==n){var l=e.getBoundingClientRect();return t(n,{isIntersecting:n,target:e,intersectionRatio:"number"===typeof r.threshold?r.threshold:0,time:0,boundingClientRect:l,intersectionRect:l,rootBounds:l}),function(){}}var o=function(e){var t=u(e),r=a.get(t);if(!r){var n,l=new Map,o=new IntersectionObserver(function(t){t.forEach(function(t){var r,o=t.isIntersecting&&n.some(function(e){return t.intersectionRatio>=e});e.trackVisibility&&"undefined"===typeof t.isVisible&&(t.isVisible=o),null==(r=l.get(t.target))||r.forEach(function(e){e(o,t)})})},e);n=o.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),r={id:t,observer:o,elements:l},a.set(t,r)}return r}(r),s=o.id,i=o.observer,d=o.elements,m=d.get(e)||[];return d.has(e)||d.set(e,m),m.push(t),i.observe(e),function(){m.splice(m.indexOf(t),1),0===m.length&&(d.delete(e),i.unobserve(e)),0===d.size&&(i.disconnect(),a.delete(s))}}var f=["children","as","triggerOnce","threshold","root","rootMargin","onChange","skip","trackVisibility","delay","initialInView","fallbackInView"];function h(e){return"function"!==typeof e.children}var p=function(e){var t,r;function a(t){var r;return(r=e.call(this,t)||this).node=null,r._unobserveCb=null,r.handleNode=function(e){r.node&&(r.unobserve(),e||r.props.triggerOnce||r.props.skip||r.setState({inView:!!r.props.initialInView,entry:void 0})),r.node=e||null,r.observeNode()},r.handleChange=function(e,t){e&&r.props.triggerOnce&&r.unobserve(),h(r.props)||r.setState({inView:e,entry:t}),r.props.onChange&&r.props.onChange(e,t)},r.state={inView:!!t.initialInView,entry:void 0},r}r=e,(t=a).prototype=Object.create(r.prototype),t.prototype.constructor=t,o(t,r);var s=a.prototype;return s.componentDidUpdate=function(e){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold&&e.skip===this.props.skip&&e.trackVisibility===this.props.trackVisibility&&e.delay===this.props.delay||(this.unobserve(),this.observeNode())},s.componentWillUnmount=function(){this.unobserve(),this.node=null},s.observeNode=function(){if(this.node&&!this.props.skip){var e=this.props,t=e.threshold,r=e.root,n=e.rootMargin,l=e.trackVisibility,o=e.delay,a=e.fallbackInView;this._unobserveCb=m(this.node,this.handleChange,{threshold:t,root:r,rootMargin:n,trackVisibility:l,delay:o},a)}},s.unobserve=function(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)},s.render=function(){if(!h(this.props)){var e=this.state,t=e.inView,r=e.entry;return this.props.children({inView:t,entry:r,ref:this.handleNode})}var o=this.props,a=o.children,s=o.as,i=function(e,t){if(null==e)return{};var r,n,l={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(l[r]=e[r]);return l}(o,f);return n.createElement(s||"div",l({ref:this.handleNode},i),a)},a}(n.Component);function g(e){var t=void 0===e?{}:e,r=t.threshold,l=t.delay,o=t.trackVisibility,a=t.rootMargin,s=t.root,i=t.triggerOnce,c=t.skip,d=t.initialInView,u=t.fallbackInView,f=n.useRef(),h=n.useState({inView:!!d}),p=h[0],g=h[1],x=n.useCallback(function(e){void 0!==f.current&&(f.current(),f.current=void 0),c||e&&(f.current=m(e,function(e,t){g({inView:e,entry:t}),t.isIntersecting&&i&&f.current&&(f.current(),f.current=void 0)},{root:s,rootMargin:a,threshold:r,trackVisibility:o,delay:l},u))},[Array.isArray(r)?r.toString():r,s,a,i,c,o,u,l]);(0,n.useEffect)(function(){f.current||!p.entry||i||c||g({inView:!!d})});var b=[x,p.inView,p.entry];return b.ref=b[0],b.inView=b[1],b.entry=b[2],b}p.displayName="InView",p.defaultProps={threshold:0,triggerOnce:!1,initialInView:!1}},3488:(e,t,r)=>{"use strict";var n=r(3959);function l(){}function o(){}o.resetWarningCache=l,e.exports=function(){function e(e,t,r,l,o,a){if(a!==n){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:l};return r.PropTypes=r,r}},3770:(e,t,r)=>{"use strict";t.A=void 0;var n=a(r(9950)),l=a(r(1942)),o=a(r(8738));function a(e){return e&&e.__esModule?e:{default:e}}const s=e=>{let{animate:t=!0,className:r="",layout:l="2-columns",lineColor:a="#FFF",children:s}=e;return"object"===typeof window&&document.documentElement.style.setProperty("--line-color",a),n.default.createElement("div",{className:(0,o.default)(r,"vertical-timeline",{"vertical-timeline--animate":t,"vertical-timeline--two-columns":"2-columns"===l,"vertical-timeline--one-column-left":"1-column"===l||"1-column-left"===l,"vertical-timeline--one-column-right":"1-column-right"===l})},s)};s.propTypes={children:l.default.oneOfType([l.default.arrayOf(l.default.node),l.default.node]).isRequired,className:l.default.string,animate:l.default.bool,layout:l.default.oneOf(["1-column-left","1-column","2-columns","1-column-right"]),lineColor:l.default.string};var i=s;t.A=i},3959:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},7320:(e,t,r)=>{"use strict";t.A=void 0;var n=s(r(9950)),l=s(r(1942)),o=s(r(8738)),a=r(2296);function s(e){return e&&e.__esModule?e:{default:e}}const i=e=>{let{children:t="",className:r="",contentArrowStyle:l=null,contentStyle:s=null,date:i="",dateClassName:c="",icon:d=null,iconClassName:u="",iconOnClick:m=null,onTimelineElementClick:f=null,iconStyle:h=null,id:p="",position:g="",style:x=null,textClassName:b="",intersectionObserverProps:v={rootMargin:"0px 0px -40px 0px",triggerOnce:!0},visible:y=!1}=e;return n.default.createElement(a.InView,v,e=>{let{inView:a,ref:v}=e;return n.default.createElement("div",{ref:v,id:p,className:(0,o.default)(r,"vertical-timeline-element",{"vertical-timeline-element--left":"left"===g,"vertical-timeline-element--right":"right"===g,"vertical-timeline-element--no-children":""===t}),style:x},n.default.createElement(n.default.Fragment,null,n.default.createElement("span",{style:h,onClick:m,className:(0,o.default)(u,"vertical-timeline-element-icon",{"bounce-in":a||y,"is-hidden":!(a||y)})},d),n.default.createElement("div",{style:s,onClick:f,className:(0,o.default)(b,"vertical-timeline-element-content",{"bounce-in":a||y,"is-hidden":!(a||y)})},n.default.createElement("div",{style:l,className:"vertical-timeline-element-content-arrow"}),t,n.default.createElement("span",{className:(0,o.default)(c,"vertical-timeline-element-date")},i))))})};i.propTypes={children:l.default.oneOfType([l.default.arrayOf(l.default.node),l.default.node]),className:l.default.string,contentArrowStyle:l.default.shape({}),contentStyle:l.default.shape({}),date:l.default.node,dateClassName:l.default.string,icon:l.default.element,iconClassName:l.default.string,iconStyle:l.default.shape({}),iconOnClick:l.default.func,onTimelineElementClick:l.default.func,id:l.default.string,position:l.default.string,style:l.default.shape({}),textClassName:l.default.string,visible:l.default.bool,intersectionObserverProps:l.default.shape({root:l.default.object,rootMargin:l.default.string,threshold:l.default.number,triggerOnce:l.default.bool})};var c=i;t.A=c},7571:(e,t,r)=>{"use strict";e.exports={VerticalTimeline:r(3770).A,VerticalTimelineElement:r(7320).A}},7681:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b});var n=r(9950),l=r(8429),o=r(9539),a=r(7571),s=r(9348),i=r(4243),c=(r(7705),r(4414));const d=(e,t)=>{if(!e||"string"!==typeof e)return console.error("Invalid URL received:",e),"";try{if(!e.includes("cloudinary.com"))return e;const r=e.match(/(.+)\/v\d+\/(.+)$/);if(!r)return e;const[,n,l]=r,o=(null===t||void 0===t?void 0:t.replace(/[^a-zA-Z0-9.-]/g,"_"))||"download.pdf",a=`${n}/v${e.match(/v(\d+)/)[1]}/${l}?fl_attachment=${o}`;return console.log("Fixed download URL:",a),a}catch(r){return console.error("Error fixing download URL:",r),e}},u=e=>{var t,r,l,o,a,s;let{product:u,getDownloadUrl:m}=e;const[f,h]=(0,n.useState)(null);return m(u.certFile)?(0,c.jsxs)("div",{className:"col-span-1 sm:col-span-2 text-gray-700 dark:text-gray-300 text-sm sm:text-base mt-1",children:[(0,c.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,c.jsx)("strong",{children:"Certificate:"}),((null===(t=u.certFile)||void 0===t?void 0:t.originalFileName)||(null===(r=u.certFile)||void 0===r?void 0:r.fileName))&&(0,c.jsxs)("span",{className:"text-xs text-gray-500",children:["(",u.certFile.originalFileName||u.certFile.fileName,")"]})]}),(0,c.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,c.jsxs)("button",{onClick:()=>{let e=m(u.certFile);if(!e)return h("Certificate URL not available"),void console.error("No certificate URL available. Product certFile:",u.certFile);console.log("Original certificate URL:",e),console.log("Product certFile data:",u.certFile),h(null);try{var t,r;const n=(null===(t=u.certFile)||void 0===t?void 0:t.fileName)||(null===(r=u.certFile)||void 0===r?void 0:r.originalFileName)||"",l=n.toLowerCase().endsWith(".pdf")||e.toLowerCase().includes(".pdf");console.log("File name:",n,"Is PDF:",l);let o=e;if(e.includes("cloudinary.com")&&e.includes("/fl_attachment:")){const t=e.split("/fl_attachment:");if(2===t.length){const e=t[1].match(/\/v\d+\/.+$/);e&&(o=`${t[0]}${e[0]}`,console.log("Fixed broken URL for viewing:",o))}}l&&e.includes("cloudinary.com")&&(o=(e=>{if(e.includes("cloudinary.com")){if(e.includes("/raw/upload/"))return e.replace("/raw/upload/","/image/upload/");if(e.includes("/image/upload/"))return e;if(e.includes("/upload/")){const t=e.split("/upload/");return`${t[0]}/image/upload/${t[1]}`}}return e})(o),console.log("Transformed Cloudinary PDF URL:",o)),console.log("Opening URL in new tab:",o),window.open(o,"_blank")}catch(n){console.error("Error opening certificate:",n),h("Failed to open certificate. Please try downloading instead.")}},className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-green-400 text-green-500 font-semibold bg-transparent hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors shadow-sm text-sm focus:outline-none focus:ring-2 focus:ring-green-400",children:[(0,c.jsx)(i.veT,{}),"View"]}),(0,c.jsxs)("a",{href:d(m(u.certFile),(null===(l=u.certFile)||void 0===l?void 0:l.originalFileName)||(null===(o=u.certFile)||void 0===o?void 0:o.fileName)),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-blue-400 text-blue-500 font-semibold bg-transparent hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors shadow-sm text-sm focus:outline-none focus:ring-2 focus:ring-blue-400",style:{textDecoration:"none"},download:(null===(a=u.certFile)||void 0===a?void 0:a.originalFileName)||(null===(s=u.certFile)||void 0===s?void 0:s.fileName)||"certificate.pdf",onClick:()=>{var e,t,r,n;const l=d(m(u.certFile),(null===(e=u.certFile)||void 0===e?void 0:e.originalFileName)||(null===(t=u.certFile)||void 0===t?void 0:t.fileName));console.log("Download link clicked. URL:",l),console.log("Download filename:",(null===(r=u.certFile)||void 0===r?void 0:r.originalFileName)||(null===(n=u.certFile)||void 0===n?void 0:n.fileName)||"certificate.pdf")},children:[(0,c.jsx)(i.WCW,{}),"Download"]})]}),f&&(0,c.jsxs)("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded-lg text-red-700 text-xs flex items-center gap-2",children:[(0,c.jsx)(i.BS8,{}),f]})]}):(0,c.jsxs)("div",{className:"col-span-1 sm:col-span-2 text-gray-500 text-sm sm:text-base mt-1",children:[(0,c.jsx)("strong",{children:"Certificate:"})," ",(0,c.jsx)("span",{children:"No certificate uploaded"})]})};r(2959),r(3762);var m=r(8286),f=r(9095),h=r(3505);const p=["Harvested","Processed","Packaged","Shipped","Delivered","Sold"];function g(e){if(!e)return null;if("object"===typeof e&&e.publicUrl)return e.publicUrl;if("string"===typeof e&&e){const{resolveFileURL:t}=r(3505);return t(e)}return null}function x(e){if(!e)return console.log("No file data provided"),null;if("object"===typeof e){let t=null;if(e.downloadUrl)console.log("Using downloadUrl from file data:",e.downloadUrl),t=e.downloadUrl;else if(e.shareUrl)console.log("Using shareUrl from file data:",e.shareUrl),t=e.shareUrl;else if(e.publicUrl)console.log("Using publicUrl from file data:",e.publicUrl),t=e.publicUrl;else if(e.url)console.log("Using url from file data:",e.url),t=e.url;else{if(!e.secure_url)return console.log("File data object has no URL:",e),null;console.log("Using secure_url from file data:",e.secure_url),t=e.secure_url}if(t&&t.includes("cloudinary.com")&&t.includes("/fl_attachment:")&&t.includes("pdf")){t=function(e,t){if(!e||!e.includes("cloudinary.com"))return e;try{if(e.includes("/fl_attachment:")){const r=e.split("/fl_attachment:")[0],n=e.split("/fl_attachment:")[1].match(/\/v\d+\/(.+)$/);if(n){const l=n[0],o=r.lastIndexOf("/upload");if(-1!==o){const n=r.substring(0,o),a=`${n}/upload/fl_attachment:${t?t.replace(/[^a-zA-Z0-9.-]/g,"_"):"file"}${l}`;return console.log("\ud83d\udd27 Fixed download URL:",{original:e,fixed:a}),a}}}}catch(r){console.error("\u274c Error fixing download URL:",r)}return e}(t,e.originalFileName||e.fileName||"certificate.pdf")}return t}return"string"===typeof e&&e?(console.log("Using string URL/path:",e),e.startsWith("/uploads")?`${(0,h.getAPIBaseURL)()}${e}`:e):(console.log("Unknown file data format:",e),null)}const b=function(){const{id:e}=(0,l.g)(),t=(0,l.Zp)(),[r,d]=(0,n.useState)(null),[h,b]=(0,n.useState)(!0),[v,y]=(0,n.useState)(!1),[j,w]=(0,n.useState)(""),[N,k]=(0,n.useState)(null),[C,R]=(0,n.useState)(""),[F,U]=(0,n.useState)(null),[S,_]=(0,n.useState)(!1),[O,V]=(0,n.useState)(null),I=async()=>{try{if(!r||!r.productId)return;_(!0);const e=await fetch(`/api/product/${r.productId}/qr`);if(!e.ok)throw new Error("Failed to fetch QR code");const t=await e.json();t.success&&t.qrCode&&(U(t.qrCode),d(e=>({...e,qrCode:t.qrCode})))}catch(e){console.error("Error fetching QR code:",e),s.oR.error("Failed to load QR code")}finally{_(!1)}};if((0,n.useEffect)(()=>{var e;const t=localStorage.getItem("token");if(t)try{const e=JSON.parse(atob(t.split(".")[1]));k(e)}catch(n){k(null)}const r=null===(e=window.history.state)||void 0===e?void 0:e.usr;null!==r&&void 0!==r&&r.txHash&&(V(r.txHash),console.log("Transaction hash detected:",r.txHash))},[]),(0,n.useEffect)(()=>{fetch(`/api/product/${e}`).then(e=>{if(!e.ok)throw new Error("Product not found or API error");return e.json()}).then(e=>{d(e),b(!1)}).catch(e=>{s.oR.error(e.message),b(!1)})},[e]),(0,n.useEffect)(()=>{r&&r.productId&&!r.qrCode&&I()},[r]),h)return(0,c.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex justify-center items-center",children:[(0,c.jsx)(f.A,{count:40}),(0,c.jsxs)("div",{className:"text-center relative z-10",children:[(0,c.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto mb-4"}),(0,c.jsx)("p",{className:"text-gray-300",children:"Loading product details..."})]})]});if(!r)return(0,c.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex justify-center items-center",children:[(0,c.jsx)(f.A,{count:40}),(0,c.jsxs)("div",{className:"text-center relative z-10",children:[(0,c.jsx)("p",{className:"text-red-400 text-xl",children:"Product not found."}),(0,c.jsxs)(m.A,{variant:"ghost",className:"mt-4",onClick:()=>t("/"),children:[(0,c.jsx)(i.QVr,{className:"mr-2"}),"Go Back"]})]})]});const E=r.stages&&r.stages.length>0?r.stages[r.stages.length-1]:null,T=N&&("producer"===N.role||"admin"===N.role);return(0,c.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 relative overflow-hidden flex flex-col justify-center items-center py-8 px-4",children:[(0,c.jsx)(f.A,{count:60}),(0,c.jsx)(s.N9,{position:"top-center",theme:"dark"}),(0,c.jsxs)(o.P.div,{className:"card w-full max-w-3xl p-0 sm:p-0 rounded-2xl bg-white/90 dark:bg-gray-900/90 text-gray-900 dark:text-gray-100 shadow-xl border border-blue-500/10 overflow-hidden mx-auto",initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.5},children:[(0,c.jsx)("div",{className:"w-full h-48 sm:h-64 bg-gradient-to-br from-blue-200 to-cyan-200 dark:from-blue-900 dark:to-cyan-900 flex items-center justify-center overflow-hidden",children:g(r.imageFile)?(0,c.jsx)("img",{src:g(r.imageFile),alt:r.name,className:"object-cover w-full h-full",onError:e=>{e.target.onerror=null,e.target.src="https://via.placeholder.com/600x300?text=No+Image"}}):(0,c.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full text-blue-400",children:[(0,c.jsx)(i.rrY,{className:"text-6xl mb-2"}),(0,c.jsx)("span",{className:"text-xs",children:"No Image"})]})}),(0,c.jsxs)("div",{className:"p-4 sm:p-8",children:[(0,c.jsxs)(o.P.button,{whileHover:{scale:1.05},whileTap:{scale:.97},className:"mb-6 px-6 py-2 rounded-xl border border-blue-400 text-blue-500 font-semibold flex items-center gap-2 hover:bg-blue-50 dark:hover:bg-blue-900/20 transition-colors",onClick:()=>t(-1),children:[(0,c.jsx)(i.QVr,{}),"Back"]}),(0,c.jsx)("h2",{className:"text-2xl sm:text-3xl md:text-4xl font-bold mb-4 text-center break-words",children:r.name}),(0,c.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 mb-4",children:[(0,c.jsxs)("div",{className:"text-gray-700 dark:text-gray-300 text-sm sm:text-base",children:[(0,c.jsx)("strong",{children:"Product ID:"})," ",r.productId]}),(0,c.jsxs)("div",{className:"text-gray-700 dark:text-gray-300 text-sm sm:text-base",children:[(0,c.jsx)("strong",{children:"Origin:"})," ",r.origin]}),(0,c.jsxs)("div",{className:"text-gray-700 dark:text-gray-300 text-sm sm:text-base",children:[(0,c.jsx)("strong",{children:"Manufacturer:"})," ",r.manufacturer]}),(0,c.jsxs)("div",{className:"text-gray-700 dark:text-gray-300 text-sm sm:text-base overflow-x-auto",children:[(0,c.jsx)("strong",{children:"Cert Hash:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.blockchainRefHash})]}),O&&(0,c.jsxs)("div",{className:"col-span-1 sm:col-span-2 text-gray-700 dark:text-gray-300 text-sm sm:text-base overflow-x-auto bg-blue-50 dark:bg-blue-900/20 p-2 rounded-lg border border-blue-200 dark:border-blue-800 mt-2",children:[(0,c.jsx)("strong",{children:"Last Transaction Hash:"}),(0,c.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,c.jsx)("span",{className:"break-all font-mono text-xs",children:O}),(0,c.jsx)("button",{className:"text-blue-500 hover:text-blue-700",onClick:()=>{navigator.clipboard.writeText(O),s.oR.info("Transaction hash copied!",{autoClose:1500})},title:"Copy hash",children:(0,c.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,c.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),r.description&&(0,c.jsxs)("div",{className:"col-span-1 sm:col-span-2 text-gray-700 dark:text-gray-300 text-sm sm:text-base",children:[(0,c.jsx)("strong",{children:"Description:"})," ",r.description]}),(0,c.jsx)(u,{product:r,getDownloadUrl:x}),(0,c.jsxs)("div",{className:"col-span-1 sm:col-span-2 text-gray-700 dark:text-gray-300 text-sm sm:text-base flex flex-col items-center gap-2 mt-4 p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[(0,c.jsx)("strong",{children:"Product QR Code:"}),S?(0,c.jsx)("div",{className:"w-32 h-32 flex items-center justify-center",children:(0,c.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"})}):r.qrCode&&r.qrCode.publicUrl?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("img",{src:r.qrCode.publicUrl,alt:"Product QR Code",className:"w-32 h-32 object-contain bg-white p-2 rounded-lg"}),(0,c.jsxs)("button",{onClick:()=>{var e,t;if((null===r||void 0===r||null===(e=r.qrCode)||void 0===e||!e.publicUrl)&&(null===r||void 0===r||null===(t=r.qrCode)||void 0===t||!t.downloadUrl))return void s.oR.error("No QR code available to download");const n=`qr_${r.productId}.png`;try{const e=r.qrCode.publicUrl;if(e.startsWith("data:")){const t=document.createElement("a");t.href=e,t.download=n,document.body.appendChild(t),t.click(),document.body.removeChild(t),s.oR.success("QR code downloaded successfully!")}else{let t=r.qrCode.downloadUrl||e;if(t.includes("cloudinary.com")&&t.includes("/fl_attachment:")){const e=t.split("/fl_attachment:");if(2===e.length){const r=e[1].match(/\/v\d+\/.+$/);r&&(t=`${e[0]}${r[0]}?fl_attachment=${n}`,console.log("Fixed broken QR download URL:",t))}}t.includes("cloudinary.com")&&!t.includes("fl_attachment")&&(t=`${t}${t.includes("?")?"&":"?"}fl_attachment=${n}`),console.log("QR download URL:",t);const l=document.createElement("a");l.href=t,l.download=n,l.target="_blank",l.rel="noopener noreferrer",document.body.appendChild(l),l.click(),document.body.removeChild(l),s.oR.success("QR code download started!")}}catch(l){console.error("QR download error:",l),s.oR.error("Failed to download QR code")}},className:"mt-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2 transition-colors",children:[(0,c.jsx)(i.Acq,{className:"w-4 h-4"}),"Download QR Code"]})]}):(0,c.jsxs)("button",{onClick:I,className:"mt-2 px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg flex items-center gap-2 transition-colors",children:[(0,c.jsx)(i.Acq,{className:"w-4 h-4"}),"Generate QR Code"]})]})]}),(0,c.jsxs)("div",{className:"mb-6 flex flex-col sm:flex-row sm:items-center gap-2",children:[(0,c.jsx)("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:"Status:"}),E?(0,c.jsx)("span",{className:"inline-block px-3 py-1 rounded-full bg-blue-100 dark:bg-blue-800 text-blue-700 dark:text-blue-300 text-xs font-semibold",children:E}):(0,c.jsx)("span",{className:"inline-block px-3 py-1 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-500 text-xs font-semibold",children:"No Status"}),T&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("select",{className:"ml-0 sm:ml-4 px-3 py-1 rounded-lg border border-blue-300 text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none",value:j,onChange:e=>w(e.target.value),disabled:v,children:[(0,c.jsx)("option",{value:"",children:"Update Status..."}),p.map(e=>(0,c.jsx)("option",{value:e,children:e},e))]}),(0,c.jsxs)("div",{className:"flex flex-col mt-2 sm:mt-0",children:[(0,c.jsxs)("div",{className:"flex items-center gap-1 ml-0 sm:ml-2 mb-1",children:[(0,c.jsx)(i.JhU,{className:"text-amber-500 text-xs"}),(0,c.jsx)("span",{className:"text-amber-600 dark:text-amber-400 text-xs font-medium",children:"Password required"})]}),(0,c.jsx)("input",{type:"password",className:"ml-0 sm:ml-2 px-3 py-1 rounded-lg border border-amber-300 text-sm focus:ring-2 focus:ring-amber-500 focus:outline-none bg-amber-50 dark:bg-amber-900/20",placeholder:"Enter password to confirm",value:C,onChange:e=>R(e.target.value),disabled:v,required:!0})]}),(0,c.jsx)("button",{className:"ml-0 sm:ml-2 px-4 py-1 rounded-lg bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-semibold hover:from-blue-600 hover:to-cyan-600 transition-colors text-sm disabled:opacity-50",onClick:async()=>{if(j){y(!0);try{const e=await fetch(`/api/update-product/${r.productId}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({stage:j})}),t=await e.json();if(!e.ok)throw new Error(t.error||"Failed to update status");t.txHash&&V(t.txHash),d(e=>({...e,stages:[...e.stages||[],j],blockchainTx:t.blockchainTx})),s.oR.success("Status updated successfully!"),w("")}catch(e){console.error("Status update error:",e),s.oR.error(e.message)}finally{y(!1)}}},disabled:!j||!C||v,children:v?"Updating...":(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.uO9,{className:"inline mr-1"}),"Update"]})})]})]}),(0,c.jsx)("h3",{className:"text-xl sm:text-2xl font-bold mb-4 text-center",children:"Product Lifecycle"}),(0,c.jsx)(a.VerticalTimeline,{layout:"1-column",lineColor:"#3b82f6",children:(r.stages||[]).map((e,t)=>(0,c.jsxs)(a.VerticalTimelineElement,{contentStyle:{background:"rgba(59, 130, 246, 0.1)",color:"#1e293b",boxShadow:"none",borderRadius:"0.75rem"},contentArrowStyle:{borderRight:"7px solid #3b82f6"},iconStyle:{background:"#3b82f6",color:"#fff",boxShadow:"0 0 0 4px #3b82f6, inset 0 2px 0 rgba(0,0,0,.08), 0 3px 0 rgba(0,0,0,.05)"},icon:(0,c.jsx)("span",{children:t+1}),date:null,children:[(0,c.jsx)("h4",{className:"vertical-timeline-element-title font-semibold text-gray-900 dark:text-gray-100",children:e}),(0,c.jsx)("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:new Date(r.createdAt).toLocaleString()})]},t))}),r.blockchainTx&&(0,c.jsxs)("div",{className:"mt-6 p-4 bg-gray-100 dark:bg-slate-700 rounded-lg text-xs sm:text-sm text-gray-700 dark:text-gray-300 border border-gray-200 dark:border-slate-600 overflow-x-auto",children:[(0,c.jsx)("strong",{children:"Blockchain Transaction:"})," ",(0,c.jsx)("a",{href:`https://sepolia.etherscan.io/tx/${r.blockchainTx}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 dark:text-blue-400 hover:underline break-all",children:r.blockchainTx})]}),r.onChain&&(0,c.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-slate-700 rounded-lg border border-gray-200 dark:border-slate-600",children:[(0,c.jsx)("h4",{className:"font-semibold mb-2 text-lg text-gray-900 dark:text-gray-100",children:"On-Chain Data:"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-xs sm:text-sm text-gray-700 dark:text-gray-300",children:[(0,c.jsxs)("div",{className:"truncate",children:[(0,c.jsx)("strong",{children:"Product ID:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.onChain[0]})]}),(0,c.jsxs)("div",{className:"truncate",children:[(0,c.jsx)("strong",{children:"Name:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.onChain[1]})]}),(0,c.jsxs)("div",{className:"truncate",children:[(0,c.jsx)("strong",{children:"Origin:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.onChain[2]})]}),(0,c.jsxs)("div",{className:"truncate",children:[(0,c.jsx)("strong",{children:"Manufacturer:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.onChain[3]})]}),(0,c.jsxs)("div",{className:"col-span-2 truncate",children:[(0,c.jsx)("strong",{children:"Stages:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.onChain[4]&&r.onChain[4].join(", ")})]}),(0,c.jsxs)("div",{className:"col-span-2 truncate",children:[(0,c.jsx)("strong",{children:"Cert Hash:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.onChain[5]})]}),(0,c.jsxs)("div",{className:"truncate",children:[(0,c.jsx)("strong",{children:"Timestamp:"})," ",(0,c.jsx)("span",{className:"break-all",children:new Date(1e3*parseInt(r.onChain[6])).toLocaleString()})]}),(0,c.jsxs)("div",{className:"truncate",children:[(0,c.jsx)("strong",{children:"Creator:"})," ",(0,c.jsx)("span",{className:"break-all",children:r.onChain[7]})]})]})]})]})]})]})}},8738:(e,t)=>{var r;!function(){"use strict";var n={}.hasOwnProperty;function l(){for(var e="",t=0;t<arguments.length;t++){var r=arguments[t];r&&(e=a(e,o(r)))}return e}function o(e){if("string"===typeof e||"number"===typeof e)return e;if("object"!==typeof e)return"";if(Array.isArray(e))return l.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var r in e)n.call(e,r)&&e[r]&&(t=a(t,r));return t}function a(e,t){return t?e?e+" "+t:e+t:e}e.exports?(l.default=l,e.exports=l):void 0===(r=function(){return l}.apply(t,[]))||(e.exports=r)}()}}]);