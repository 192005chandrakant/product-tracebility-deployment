"use strict";(self.webpackChunkproduct_traceability_client=self.webpackChunkproduct_traceability_client||[]).push([[469],{757:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(9950),a=s(3505);const l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;const[t,s]=(0,r.useState)({totalProducts:0,totalScans:0,totalUpdates:0,recentProducts:[],recentUpdates:[],timestamp:null}),[l,n]=(0,r.useState)(!1),[o,i]=(0,r.useState)(null),c=(0,r.useRef)(null),d=(0,r.useRef)(!0),x=(0,r.useCallback)(async function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&n(!0),i(null);try{const e=localStorage.getItem("token");if(!e)throw new Error("No authentication token found");const n=await fetch((0,a.buildAPIURL)("/api/statistics/stats"),{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!n.ok){const e=await n.json();throw new Error(e.error||`HTTP ${n.status}`)}const i=await n.json();var t,r,l,o;if(d.current)s({totalProducts:(null===(t=i.stats)||void 0===t?void 0:t.totalProducts)||0,totalScans:(null===(r=i.stats)||void 0===r?void 0:r.totalScans)||0,totalUpdates:(null===(l=i.stats)||void 0===l?void 0:l.totalUpdates)||0,recentProducts:(null===(o=i.stats)||void 0===o?void 0:o.recentProducts)||[],timestamp:(new Date).toISOString()})}catch(c){console.error("Error fetching statistics:",c),d.current&&i(c.message)}finally{d.current&&e&&n(!1)}},[]),m=(0,r.useCallback)(()=>{c.current&&clearInterval(c.current),c.current=setInterval(()=>{x(!1)},e)},[x,e]),u=(0,r.useCallback)(()=>{c.current&&(clearInterval(c.current),c.current=null)},[]),g=(0,r.useCallback)(()=>{x(!0)},[x]);return(0,r.useEffect)(()=>(d.current=!0,x(!0),m(),()=>{d.current=!1,u()}),[x,m,u]),(0,r.useEffect)(()=>{const e=()=>{x(!1)},t=()=>{x(!0)};return window.addEventListener("productUpdated",e),window.addEventListener("productAdded",e),window.addEventListener("userLogin",t),()=>{window.removeEventListener("productUpdated",e),window.removeEventListener("productAdded",e),window.removeEventListener("userLogin",t)}},[x]),{statistics:t,loading:l,error:o,refreshStats:g,startAutoRefresh:m,stopAutoRefresh:u}}},3469:(e,t,s)=>{s.r(t),s.d(t,{default:()=>f});var r=s(9950),a=s(9539),l=s(8429),n=s(4243),o=s(9095),i=s(8286),c=s(3762),d=s(2959),x=s(9846),m=s(757),u=s(3505),g=s(4414);const p="https://via.placeholder.com/400x200?text=No+Image";function h(e){if(e&&"object"===typeof e&&e.publicUrl)return e.publicUrl;if(e&&"string"===typeof e){const{resolveFileURL:t}=s(3505);return t(e)}return p}const f=function(){const{statistics:e,loading:t,refreshStats:s}=(0,m.A)(8e3),[f,b]=(0,r.useState)([]),[j,v]=(0,r.useState)([]),[y,N]=(0,r.useState)(""),[w,k]=(0,r.useState)(""),[S,A]=(0,r.useState)("name"),[C,P]=(0,r.useState)(!0),E=(0,l.Zp)();(0,r.useEffect)(()=>{I()},[]),(0,r.useEffect)(()=>{L()},[f,y,w,S]);const I=async()=>{try{const e=await fetch((0,u.buildAPIURL)("/api/products")),t=await e.json();b(t)}catch(e){console.error("Error fetching products:",e)}finally{P(!1)}},L=()=>{let e=f.filter(e=>{var t,s;const r=(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(y.toLowerCase()))||(null===(s=e.productId)||void 0===s?void 0:s.toLowerCase().includes(y.toLowerCase())),a=!w||e.stages&&e.stages.includes(w);return r&&a});e.sort((e,t)=>{switch(S){case"name":return(e.name||"").localeCompare(t.name||"");case"id":return(e.productId||"").localeCompare(t.productId||"");case"stage":const s=e.stages&&e.stages.length>0?e.stages[e.stages.length-1]:"",r=t.stages&&t.stages.length>0?t.stages[t.stages.length-1]:"";return s.localeCompare(r);default:return 0}}),v(e)},U=[...new Set(f.flatMap(e=>e.stages||[]))];return C?(0,g.jsxs)("div",{className:"min-h-screen relative overflow-hidden",children:[(0,g.jsx)("div",{className:"absolute inset-0 z-0",children:(0,g.jsx)(d.A,{})}),(0,g.jsx)(o.A,{}),(0,g.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-900/20 via-purple-900/20 to-cyan-900/20 z-10"}),(0,g.jsx)("div",{className:"relative z-20 min-h-screen flex items-center justify-center p-4",children:(0,g.jsx)(c.A,{className:"max-w-md w-full",children:(0,g.jsxs)("div",{className:"p-8 text-center",children:[(0,g.jsx)("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,g.jsx)(n.v$b,{className:"text-white text-2xl animate-pulse"})}),(0,g.jsx)("h2",{className:"text-2xl font-bold mb-4 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Loading Dashboard"}),(0,g.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Fetching products data..."})]})})})]}):(0,g.jsxs)("div",{className:"min-h-screen relative overflow-hidden",children:[(0,g.jsx)("div",{className:"absolute inset-0 z-0",children:(0,g.jsx)(d.A,{})}),(0,g.jsx)(o.A,{}),(0,g.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-900/20 via-purple-900/20 to-cyan-900/20 z-10"}),(0,g.jsx)("div",{className:"relative z-20 min-h-screen",children:(0,g.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,g.jsxs)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-8",children:[(0,g.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,g.jsxs)("div",{className:"flex items-center gap-4",children:[(0,g.jsx)(i.A,{onClick:()=>E("/"),variant:"secondary",className:"p-3",glowColor:"blue",children:(0,g.jsx)(n.QVr,{className:"w-4 h-4"})}),(0,g.jsxs)("div",{children:[(0,g.jsx)("h1",{className:"text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent",children:"Admin Dashboard"}),(0,g.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Manage your products and track their lifecycle"})]})]}),(0,g.jsx)("div",{className:"flex items-center gap-4",children:(0,g.jsx)("div",{className:"relative",children:(0,g.jsx)(x.A,{size:.8,className:"w-20 h-20"})})})]}),(0,g.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,g.jsx)(c.A,{className:"p-6 bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/50 dark:to-blue-800/50 border-blue-200 dark:border-blue-700",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-medium",children:"Total Products"}),(0,g.jsx)("p",{className:"text-3xl font-bold text-blue-800 dark:text-blue-200",children:e.totalProducts}),(0,g.jsx)("p",{className:"text-xs text-blue-500 dark:text-blue-400 mt-1",children:"System-wide count"})]}),(0,g.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,g.jsx)(n.rrY,{className:"text-white text-xl"})})]})}),(0,g.jsx)(c.A,{className:"p-6 bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/50 dark:to-green-800/50 border-green-200 dark:border-green-700",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400 font-medium",children:"Total Scans"}),(0,g.jsx)("p",{className:"text-3xl font-bold text-green-800 dark:text-green-200",children:e.totalScans}),(0,g.jsx)("p",{className:"text-xs text-green-500 dark:text-green-400 mt-1",children:"QR code scans"})]}),(0,g.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-green-500 to-green-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,g.jsx)(n.Ny1,{className:"text-white text-xl"})})]})}),(0,g.jsx)(c.A,{className:"p-6 bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/50 dark:to-purple-800/50 border-purple-200 dark:border-purple-700",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-purple-600 dark:text-purple-400 font-medium",children:"Total Updates"}),(0,g.jsx)("p",{className:"text-3xl font-bold text-purple-800 dark:text-purple-200",children:e.totalUpdates}),(0,g.jsx)("p",{className:"text-xs text-purple-500 dark:text-purple-400 mt-1",children:"Stage updates"})]}),(0,g.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,g.jsx)(n.uO9,{className:"text-white text-xl"})})]})}),(0,g.jsx)(c.A,{className:"p-6 bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/50 dark:to-orange-800/50 border-orange-200 dark:border-orange-700",children:(0,g.jsxs)("div",{className:"flex items-center justify-between",children:[(0,g.jsxs)("div",{children:[(0,g.jsx)("p",{className:"text-sm text-orange-600 dark:text-orange-400 font-medium",children:"My Products"}),(0,g.jsx)("p",{className:"text-3xl font-bold text-orange-800 dark:text-orange-200",children:f.length}),(0,g.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,g.jsx)("p",{className:"text-xs text-orange-500 dark:text-orange-400",children:"Your products"}),(0,g.jsx)("button",{onClick:s,disabled:t,className:"text-orange-500 hover:text-orange-600 disabled:opacity-50 transition-colors",title:"Refresh Statistics",children:(0,g.jsx)(n.DIg,{className:"text-xs "+(t?"animate-spin":"")})})]})]}),(0,g.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg",children:(0,g.jsx)(n.Acq,{className:"text-white text-xl"})})]})})]})]}),(0,g.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-8",children:(0,g.jsx)(c.A,{className:"p-4 sm:p-6",children:(0,g.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,g.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,g.jsx)(n.KSO,{className:"h-4 w-4 text-gray-400"})}),(0,g.jsx)("input",{type:"text",placeholder:"Search products...",value:y,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent backdrop-blur-sm"})]}),(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsxs)("select",{value:w,onChange:e=>k(e.target.value),className:"w-full pl-3 pr-8 py-3 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent backdrop-blur-sm appearance-none",children:[(0,g.jsx)("option",{value:"",children:"All Stages"}),U.map(e=>(0,g.jsx)("option",{value:e,children:e},e))]}),(0,g.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,g.jsx)(n.z44,{className:"h-4 w-4 text-gray-400"})})]}),(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsxs)("select",{value:S,onChange:e=>A(e.target.value),className:"w-full pl-3 pr-8 py-3 bg-white/50 dark:bg-gray-700/50 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent backdrop-blur-sm appearance-none",children:[(0,g.jsx)("option",{value:"name",children:"Sort by Name"}),(0,g.jsx)("option",{value:"id",children:"Sort by ID"}),(0,g.jsx)("option",{value:"stage",children:"Sort by Stage"})]}),(0,g.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:(0,g.jsx)(n.z44,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,g.jsx)("div",{className:"flex justify-end",children:(0,g.jsxs)(i.A,{onClick:()=>E("/admin/add"),className:"w-full sm:w-auto px-6 py-3 font-semibold text-base sm:text-lg",glowColor:"green",children:[(0,g.jsx)(n.E5P,{className:"mr-2"}),"Add Product"]})})]})})}),(0,g.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},children:0===j.length?(0,g.jsxs)(c.A,{className:"p-8 sm:p-12 text-center",children:[(0,g.jsx)(n.rrY,{className:"w-12 h-12 sm:w-16 sm:h-16 text-gray-400 mx-auto mb-4"}),(0,g.jsx)("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No products found"}),(0,g.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:y||w?"Try adjusting your search or filters":"Start by adding your first product"}),(0,g.jsxs)(i.A,{onClick:()=>E("/admin/add"),className:"w-full sm:w-auto px-6 py-3 font-semibold text-base sm:text-lg",glowColor:"blue",children:[(0,g.jsx)(n.E5P,{className:"mr-2"}),"Add Product"]})]}):(0,g.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:j.map((e,t)=>{return(0,g.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},whileHover:{scale:1.02,y:-5},className:"group",children:(0,g.jsxs)(c.A,{className:"overflow-hidden h-full flex flex-col",children:[(0,g.jsxs)("div",{className:"relative",children:[(0,g.jsx)("div",{className:"h-48 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 flex items-center justify-center overflow-hidden",children:(r=e.imageFile,r&&"object"===typeof r&&r.publicUrl||r&&"string"===typeof r&&(r.startsWith("http")||r.startsWith("/"))?(0,g.jsx)("img",{src:h(e.imageFile),alt:e.name,className:"object-cover w-full h-full group-hover:scale-105 transition-transform duration-300",onError:e=>{e.target.onerror=null,e.target.src=p}}):(0,g.jsxs)("div",{className:"flex flex-col items-center justify-center text-gray-400",children:[(0,g.jsx)(n.rrY,{className:"text-4xl mb-2"}),(0,g.jsx)("span",{className:"text-sm",children:"No Image"})]}))}),(0,g.jsx)("div",{className:"absolute top-2 right-2",children:e.stages&&e.stages.length>0?(0,g.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-semibold text-white bg-gradient-to-r ${s=e.stages[e.stages.length-1],{Harvested:"from-green-500 to-green-600",Processed:"from-yellow-500 to-yellow-600",Packaged:"from-blue-500 to-blue-600",Shipped:"from-purple-500 to-purple-600",Delivered:"from-cyan-500 to-cyan-600",Sold:"from-red-500 to-red-600"}[s]||"from-gray-500 to-gray-600"}`,children:e.stages[e.stages.length-1]}):(0,g.jsx)("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-semibold text-gray-500 bg-gray-200 dark:bg-gray-700",children:"No Status"})})]}),(0,g.jsxs)("div",{className:"p-4 sm:p-6 flex flex-col flex-grow",children:[(0,g.jsx)("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-2 truncate",children:e.name}),(0,g.jsxs)("div",{className:"space-y-2 mb-4 flex-grow",children:[(0,g.jsxs)("div",{className:"flex items-center text-sm text-gray-600 dark:text-gray-400",children:[(0,g.jsx)(n.Acq,{className:"w-4 h-4 mr-2 flex-shrink-0"}),(0,g.jsx)("span",{className:"font-mono truncate",children:e.productId})]}),e.description&&(0,g.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:e.description})]}),e.certFile&&(0,g.jsx)("div",{className:"mb-4",children:(0,g.jsxs)("a",{href:h(e.certFile),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm",onClick:e=>e.stopPropagation(),children:[(0,g.jsx)(n.t69,{className:"w-4 h-4 mr-1"}),"View Certificate"]})}),(0,g.jsx)("div",{className:"sticky bottom-0 left-0 right-0 pt-4 mt-auto",children:(0,g.jsxs)(i.A,{onClick:()=>E(`/product/${e.productId}`),className:"w-full py-3 font-semibold text-base sm:text-lg",glowColor:"blue",children:[(0,g.jsx)(n.Ny1,{className:"mr-2"}),"View Details"]})})]})]})},e.productId);var s,r})})})]})})]})}}}]);